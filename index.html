<html>
<head>
	<title></title>
	<style>
	body {
		background: whitesmoke;
		margin: 0;
	}
	.messages {
		background: orangered;
		width: 300px;
		padding: 10px;
		margin: 0 auto;
	}
	</style>
</head>
<body>
	<div class="messages"></div>
	<script>
	var messages = [];
	var words = ['glerfsum', 'lorem', 'dolor', 'amit', 'clamor', 'glarf'];
	var randomWord = function() {
		return words[Math.floor( Math.random() * words.length )];
	}
	var randomSentence = function() {
		return randomWord() + ' ' + randomWord() + ' ' + randomWord() + ' ' + randomWord();
	};
	for ( i=0; i<=100; i++ ) {
		messages.push( randomSentence() );
	}

	/**
	 * @constructor
	 */
	var MessageListView = function() {
		this.messagesPerPage = 20;
		this.el = document.querySelector('.messages');
		this.messages = messages;
		window.setInterval( this.checkToAddMore.bind( this ), 75 );
	};

	/**
	 * Load 20 messages into the DOM.
	 *
	 * Automatically deletes messages from the store.
	 */
	MessageListView.prototype.loadMore = function() {
		if ( ! this.messages.length ) {
			return;
		}
		var lowerBound = this.messages.length - this.messagesPerPage;
		if ( lowerBound < 0 ) {
			lowerBound = 0;
		}
		for ( var i = this.messages.length - 1; i >= lowerBound; i-- ) {
			var div = document.createElement('div');
			var textNode = document.createTextNode( '#' + i + ': ' + this.messages[i] );
			div.appendChild( textNode );
			if ( this.el.children ) {
				this.el.insertBefore( div, this.el.firstChild );
			} else {
				this.el.appendChild( div );
			}
			// Remove the message from the store.
			this.messages = this.messages.splice( 0, i );
			// Don't let the new element modify previous scrolled state.
			window.scrollTo( 0, window.scrollY + div.offsetHeight );
		}
	};

	/**
	 * Check scroll position and load more messages as needed.
	 */
	MessageListView.prototype.checkToAddMore = function() {
		if ( typeof this.lastScroll === 'undefined' ) {
			this.lastScroll = window.scrollY;
			return;
		}
		if ( this.lastScroll === window.scrollY ) {
			return;
		}
		// Need to decide when to try to load more previous messages.
		if ( window.scrollY < 300 ) {
			this.loadMore();
		}
		this.lastScroll = window.scrollY;
	};

	// Create an instance of the view and load it with messages.
	// Preferably message loading should happen automatically.
	var x = new MessageListView();
	for ( var i=0; i<=2; i++) {
		x.loadMore();
	}

	// Scroll to the bottom on first load.
	window.scrollTo( 0, x.el.offsetHeight - window.innerHeight );
	</script>
</body>
</html>